# 障害レポート (2025-12-18)

## 不具合一覧

* **検出時刻:** 11:45
* **通番:** No.1
* **不具合の概要:** `tests/test_ai_agent.py` の `test_create_prompt_without_market_context` で `AssertionError` が発生。
* **原因の提示:** (既報) テストコードの期待値と実装の乖離。
* **影響 (Impact):** テスト失敗。
* **修正案 (Proposed Fix):** (修正済み) テストコードのアサーション修正。

---

* **検出時刻:** 13:00
* **通番:** No.2
* **不具合の概要:** `StockDatabase` を `:memory:` で初期化すると、`_get_conn` 内の `os.makedirs` で `FileNotFoundError` が発生する。
* **原因の提示:** `os.path.dirname(":memory:")` が空文字列を返し、`os.makedirs("", exist_ok=True)` が失敗するため。通常、実ファイルパスを想定しているが、インメモリDB（テスト用）の考慮が不足していた。
* **影響 (Impact):** カバレッジ向上のためのインメモリDBを使用したテストが実行できない。
* **修正案 (Proposed Fix):** `_get_conn` において、`db_path` が `:memory:` の場合は `makedirs` をスキップするように修正する。
