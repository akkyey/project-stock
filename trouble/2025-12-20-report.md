* **検出時刻:** 14:30
* **通番:** No.1
* **不具合の概要:** `tools/fetch_from_ms2.py` 実行時、`tqdm` によるプログレス表示の最中に `DataFetcher` からの `INFO` ログが出力され、表示が乱れて視認性が低下している。
* **原因の提示:** `src/data_fetcher.py` の `_fetch_single_stock` 内で、毎銘柄ごとに `logger.info` を実行しており、それが標準エラー出力（または標準出力）で `tqdm` と競合している。
* **影響 (Impact):** 実行中の進捗状況（残り時間など）が確認しづらくなり、ユーザー体験を損ねている。
* **修正案 (Proposed Fix):** 毎柄の取得完了ログのレベルを `INFO` から `DEBUG` に変更する。これにより、通常の実行（INFOレベル）ではログが表示されず、プログレスバーのみが綺麗に表示されるようになる。

---

* **検出時刻:** 15:30
* **通番:** No.2
* **不具合の概要:** AI分析実行時に `429 Quota Exceeded` エラーが発生し、最大リトライ回数を超えて失敗する。また、`google.generativeai` パッケージの非推奨警告が表示されている。
* **原因の提示:** 
    1. **スロットリング不足**: `AIAgent` に `interval_sec` 設定があるものの、実際の分析ループ内で待機処理（`time.sleep`）が実装されておらず、短時間に大量のリクエストを送信している。
    2. **ライブラリの旧式化**: `google-generativeai` (v1 SDK) は非推奨となっており、`google-genai` (v2 SDK) への移行が推奨されている。
* **影響 (Impact):** AIによる銘柄分析が中断され、最終的な分析レポートが作成できない。
* **修正案 (Proposed Fix):**
    1. **ライブラリ移行**: `google-genai` パッケージを導入し、`src/ai_agent.py` を v2 SDK 準拠に書き換える。
    2. **待機処理の実装**: `AIAgent.analyze` または分析ループ内に `time.sleep(self.interval_sec)` を追加し、リクエスト間隔を制御する。
    3. **バックオフの強化**: `retry_with_backoff` のベース遅延を調整し、429エラー時により長く待機するようにする。

---

* **検出時刻:** 15:40
* **通番:** No.3
* **不具合の概要:** AI分析中またはエラー発生時、巨大なJSONレスポンスや同じエラー内容が冗長に出力され、コンソールの可読性が損なわれている。
* **原因の提示:** 
    1. **デバッグ出力の過剰**: `retry_with_backoff` や `AIAgent` 内で、エラーオブジェクトやレスポンス全体をそのまま出力している。
    2. **サマリーの欠如**: ユーザーが知りたいのは「どの銘柄がどう判定されたか」であって、生データではない。
* **影響 (Impact):** 進捗確認の妨げとなり、重要な警告が埋もれてしまう。
* **修正案 (Proposed Fix):** 
    1. **出力情報の絞り込み**: エラー時はエラーメッセージの先頭部分のみ、成功時は判定結果の抜粋のみを `INFO` レベルで出力するようにする。
    2. **ログの重複排除**: 同一原因のリトライログなどは簡略化した形式にする。

---

* **検出時刻:** 15:55
* **通番:** No.4
* **不具合の概要:** 修復モード (`--repair`) を実行しても、以前失敗した銘柄（Error）が `[Cached]` と表示され、再分析が行われない。
* **原因の提示:** `src/analyzer.py` の `process_single_stock` において、キャッシュから取得したセンチメントが `'Error'` であっても、有効なキャッシュとして扱ってしまい、AI分析をスキップしていた。
* **影響 (Impact):** 失敗レコードの自動復旧機能が実質的に機能せず、手動でDBを修正しなければならなくなる。
* **修正案 (Proposed Fix):** キャッシュ取得直後にセンチメントを確認し、`'Error'` の場合はキャッシュを無視して新規分析を強制するようにロジックを修正する。

---

* **検出時刻:** 16:05
* **通番:** No.5
* **不具合の概要:** `self_diagnostic.py` 実行時、`TypeError: 'NoneType' object is not subscriptable` が発生してテストが中断された。
* **原因の提示:** AI分析結果のコンソール表示形式を変更した際、銘柄名 (`name`) を参照するようになったが、テスト用の mock データ内に `'name'` キーが含まれていなかった。
* **影響 (Impact):** 自己診断テストが正常に完了できず、コード品質の保証が困難になる。
* **修正案 (Proposed Fix):** `self_diagnostic.py` 内のすべてのテスト用 mock データに、不足している `'name'` キーを追加する。

---

* **検出時刻:** 16:07
* **通番:** No.6
* **不具合の概要:** `self_diagnostic.py` 実行時、`TypeError: unsupported format string passed to MagicMock.__format__` が発生した。
* **原因の提示:** `analyzer.py` の修正により `process_single_stock` の戻り値（辞書）の値をログ出力するようになったが、テスト内でこの関数の戻り値をモック化し忘れた箇所があり、`MagicMock` オブジェクトがそのまま format 文字列に渡された。
* **影響 (Impact):** テストの実行不能、およびCI/CD環境での偽陰性の原因となる。
* **修正案 (Proposed Fix):** 該当するテストケース（`test_analyzer_limit_loop` 等）で、`mock_process.return_value` に期待される形式 of 辞書を正しく設定する。
