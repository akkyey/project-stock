# 2026-01-07 修正履歴

## 実ボラティリティ計算機能の追加
- **対象**: `stock-analyzer4` (Submodule)
- **目的**: 従来のベータ値（beta）が市場との相関のみを示すのに対し、銘柄自身の価格変動の激しさを年率換算で定量化するため。また、ベータ値の欠損を補い全銘柄でのリスク評価を可能にするため。
- **変更内容**:
    1. `src/fetcher/technical.py`: 日次ログリターンの標準偏差から年率ボラティリティを計算するロジックを追加。
    2. `src/fetcher/yahoo.py`: 取得データに `real_volatility` フィールドを追加。
- **検証結果**: 
    - 単体テスト (`tests/unit/test_technical_calculation.py`) パス。
    - ソフトバンクG (9984) にて `real_volatility: 70.60%` の取得を確認（ベータ 0.697 に対し、自身のリスクをより正確に反映）。
- **不具合対応通番**: なし（機能追加）
 
## リスク調整ロジック（ボラティリティ・ペナルティ）の実装
- **対象**: `stock-analyzer4` (Submodule)
- **目的**: 実ボラティリティが高い銘柄（投機的または不安定な銘柄）に対して自動的にスコアを減点し、投資精度の向上を図るため。
- **変更内容**:
    1. `config/config.yaml`: ペナルティ閾値（50%超）と減点幅（-10点）を設定。
    2. `src/calc/strategies/generic.py`: スコア計算ロジック（ベクトル演算・スカラー演算）にボラティリティ・ペナルティ適用処理を追加。
- **検証結果**: 
    - 単体テスト (`tests/unit/test_risk_adjustment.py`) パス。
    - ボラティリティが高いSBG（約70%）に対して、期待通り10点のペナルティが計上されることを確認。
- **不具合対応通番**: なし（機能追加）
 
## AI分析プロンプトへの実リスク（実ボラティリティ）の統合
- **対象**: `stock-analyzer4` (Submodule)
- **目的**: AIが銘柄独自の乱高下リスクを具体的に把握し、より精緻な投資判断・論評を生成できるようにするため。
- **変更内容**:
    1. `src/ai/prompt_builder.py`: `real_volatility` をプロンプト変数に追加。
    2. `config/ai_prompts.yaml`: 
        - 指標セクションに「実ボラティリティ」を追加。
        - 判定基準（判定ロジック）に「実ボラティリティ > 50% の場合は Neutral (Caution) を優先」する指示を追加。
- **検証結果**: 
    - 実際に出力されるプロンプト内容を検証し、具体的な数値（例：70.60%）とリスク警告が正しくAIに提示されていることを確認。
- **不具合対応通番**: なし（機能追加）
