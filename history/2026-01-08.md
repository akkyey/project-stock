
# 2026-01-08

## 修正履歴

### Notebook Refactoring (Submodule: stock-analyzer4)

*   **対象ファイル:**
    *   `notebook/run_analysis.ipynb`
    *   `notebook/run_diagnostic.ipynb`
*   **修正概要:**
    *   Colab運用体制の確立に伴い、診断ツール (`self_diagnostic.py`) の参照パスを `tools/` 配下に変更。
    *   不要な出力セルのクリアとメタデータの整理。
*   **関連タスク:** Colab運用体制の確立

### Feat: Colab Secrets Support (Submodule: stock-analyzer4)

*   **対象ファイル:**
    *   `notebook/run_analysis.ipynb`
    *   `notebook/run_diagnostic.ipynb`
*   **修正概要:**
    *   Google Colab Secrets (`google.colab.userdata`) に対応。
    *   `GITHUB_USER`, `GITHUB_TOKEN`, `GEMINI_API_KEY` をSecretsから自動取得する機能を追加。
    *   Secretsが未設定の場合は従来の対話型入力にフォールバック。
*   **関連タスク:** Colab運用体制の確立

### Fix: Notebook Error Handling (Submodule: stock-analyzer4)

*   **対象ファイル:**
    *   `notebook/run_analysis.ipynb`
    *   `notebook/run_diagnostic.ipynb`
*   **修正概要:**
    *   セットアップセル（最初のセル）を実行せずに後続のセルを実行した場合に `NameError` でクラッシュする問題を修正。
    *   `is_ready` 未定義時に「環境設定が完了していません」という明確なエラーメッセージを表示するようガード句を追加。
*   **関連タスク:** Colab運用体制の確立 (ユーザビリティ改善)

### Fix: DB Initialization Integrity (Submodule: stock-analyzer4)

*   **対象ファイル:**
    *   `notebook/run_analysis.ipynb`
*   **修正概要:**
    *   `INITIALIZE_DB = True` 実行時に `IntegrityError` (外部キー制約違反) が発生するバグを修正。
    *   テーブルへの挿入順序を `MarketData` (子) → `Stock` (親) から、`Stock` (親) → `MarketData` (子) に変更。
*   **関連タスク:** Colab運用体制の確立
