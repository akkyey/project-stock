
# 2026-01-08

## 修正履歴

### Notebook Refactoring (Submodule: stock-analyzer4)

*   **対象ファイル:**
    *   `notebook/run_analysis.ipynb`
    *   `notebook/run_diagnostic.ipynb`
*   **修正概要:**
    *   Colab運用体制の確立に伴い、診断ツール (`self_diagnostic.py`) の参照パスを `tools/` 配下に変更。
    *   不要な出力セルのクリアとメタデータの整理。
*   **関連タスク:** Colab運用体制の確立

### Feat: Colab Secrets Support (Submodule: stock-analyzer4)

*   **対象ファイル:**
    *   `notebook/run_analysis.ipynb`
    *   `notebook/run_diagnostic.ipynb`
*   **修正概要:**
    *   Google Colab Secrets (`google.colab.userdata`) に対応。
    *   `GITHUB_USER`, `GITHUB_TOKEN`, `GEMINI_API_KEY` をSecretsから自動取得する機能を追加。
    *   Secretsが未設定の場合は従来の対話型入力にフォールバック。
*   **関連タスク:** Colab運用体制の確立

### Fix: Notebook Error Handling (Submodule: stock-analyzer4)

*   **対象ファイル:**
    *   `notebook/run_analysis.ipynb`
    *   `notebook/run_diagnostic.ipynb`
*   **修正概要:**
    *   セットアップセル（最初のセル）を実行せずに後続のセルを実行した場合に `NameError` でクラッシュする問題を修正。
    *   `is_ready` 未定義時に「環境設定が完了していません」という明確なエラーメッセージを表示するようガード句を追加。
*   **関連タスク:** Colab運用体制の確立 (ユーザビリティ改善)

### Fix: DB Initialization Integrity (Submodule: stock-analyzer4)

*   **対象ファイル:**
    *   `notebook/run_analysis.ipynb`
*   **修正概要:**
    *   `INITIALIZE_DB = True` 実行時に `IntegrityError` (外部キー制約違反) が発生するバグを修正。
    *   テーブルへの挿入順序を `MarketData` (子) → `Stock` (親) から、`Stock` (親) → `MarketData` (子) に変更。
*   **関連タスク:** Colab運用体制の確立

### Feat: Full Stock Fetch Support (Submodule: stock-analyzer4)

*   **対象ファイル:**
    *   `notebook/run_analysis.ipynb`
*   **修正概要:**
    *   DB初期化時 (`INITIALIZE_DB = True`) に、従来のデモ用5件ではなく、全銘柄（JPXリスト）を取得するように変更。
    *   フォームで `FETCH_LIMIT` を設定することで、取得件数を制限できるように修正（デフォルト0 = 無制限）。
*   **関連タスク:** Colab運用体制の確立

### Feat: Progress Visibility Improvement (Submodule: stock-analyzer4)

*   **対象ファイル:**
    *   `src/fetcher/jpx.py`
    *   `src/fetcher/facade.py`
*   **修正概要:**
    *   JPXリストダウンロード時にステータスを表示するように `print` 文を追加。
    *   Colabでのプログレスバー表示を改善するために `tqdm.auto` を使用するように変更。
*   **関連タスク:** Colab運用体制の確立 (ユーザビリティ改善)

### Feat: Debug Mode & Notebook Layout (Submodule: stock-analyzer4)

*   **対象ファイル:**
    *   `notebook/run_analysis.ipynb`
    *   `src/orchestrator.py`
*   **修正概要:**
    *   ノートブックに「デバッグモード (DEBUG_MODE)」のチェックボックスを追加。
    *   デバッグモード時はAI APIコールを抑止（Mock応答）し、かつ処理対象を大幅に制限（Daily: Top 5, Weekly: Top 100）するようにロジックを追加。
    *   ノートブックのセル配置を変更し、「Weekly分析（週末）」を「Daily分析」より前に配置。
*   **関連タスク:** Colab運用体制の確立 (ユーザビリティ改善)
